{
  "version": 3,
  "sources": ["../index.ts"],
  "sourcesContent": ["import express from \"express\"\nimport session from \"express-session\"\nimport expressLayouts from \"express-ejs-layouts\"\nimport { MongoClient, ServerApiVersion, ObjectId } from \"mongodb\";\n\nconst DATABASE_URL = `mongodb+srv://${process.env.DB_USER}:${process.env.DB_PASSWORD}@smartlist-events.4zcyg.mongodb.net/Smartlist-Events?retryWrites=true&w=majority`;\n\nfunction eventInfo(id:string, req):Promise<Array> {\n  return new Promise((resolve, reject) => {\n\t\tif(id.length!==24) {\n\t\t\tresolve(false);\n\t\t\treturn;\n\t\t}\n    if (req.session.eventCache) {\n      resolve(req.session.eventCache);\n      return;\n    }\n    MongoClient.connect(DATABASE_URL, (err, db: any) => {\n      if (err) throw err;\n      let dbo = db.db(\"Events\");\n      let query = { _id: new ObjectId(id) };\n      dbo\n        .collection(\"EventList\")\n        .find(query)\n        .toArray((err:any, result: any) => {\n          if (err) throw err;\n          result = result[0];\n          req.session.eventCache = result;\n          resolve(result);\n          db.close();\n        });\n    });\n  });\n}\nfunction eventData(parent:string, table:string):Promise<Array> {\n  return new Promise((resolve, reject) => {\n    MongoClient.connect(DATABASE_URL, (err, db: any) => {\n      if (err) throw err;\n      let dbo = db.db(\"Events\");\n      let query = { parent: new ObjectId(parent) };\n      dbo\n        .collection(table)\n        .find(query)\n        .toArray((err:any, result:any) => {\n          if (err) throw err;\n          resolve(result);\n          db.close();\n        });\n    });\n  });\n}\n\nfunction createEventData(data:Object, table: string):Promise<string> {\n  return new Promise((resolve, reject) => {\n\t\tMongoClient.connect(DATABASE_URL, (err, db: any) => {\n\t\t  if (err) throw err;\n\t\t  var dbo = db.db(\"Events\");\n\t\t  dbo.collection(table).insertOne(data, (err:any, res:any) => {\n\t\t    if (err) throw err;\n\t\t    resolve(res);\n\t\t    db.close();\n\t\t  });\n\t\t});\n  });\n}\n\nconst app = express();\n\napp.set(\"view engine\", \"ejs\");\napp.use(expressLayouts);\n\napp.set(\"trust proxy\", 1); // trust first proxy\n\nconst server = require(\"http\").createServer(app);\nconst io = require(\"socket.io\")(server);\n\nconst token = \"6227ea2c7aabff48117758b7\";\n\ninterface Event {\n  title: string;\n  short_description: string;\n  description: string;\n  budget: number;\n  datetime: \"2022-03-11T19:44:58.419Z\";\n  location: \"Discord\";\n  cost: 10;\n  private: false;\n  contact?: {\n    email?: string;\n    twitter?: string;\n    discord?: string;\n    github?: string;\n  };\n}\n\nconst sessionMiddleware =  session({\n\tsecret: \"keyboard cat\",\n\tresave: true,\n\tsaveUninitialized: true,\n\tcookie: { secure: true },\n});\napp.use(sessionMiddleware);\n\nio.use((socket: any, next: any) => \n\tsessionMiddleware(socket.request, {}, next));\n\nio.on('connection', (socket:any) => {\n\t\tsocket.join(token);\n\t  console.log('New user: ' + socket.id);\n\t  socket.on('chat-message', (data:any) => {\n\t\t\tio.to(token).emit(\"chat-message\", data);\n\t\t});\n\n\tsocket.on('add-menu', async (data:any) => {\n\t\tdata.parent = new ObjectId(data.parent);\n\t\tlet res = await createEventData(data, \"Food\")\n\t\tlet d = {\n\t\t\t...data,\n\t\t\t_id: res.insertedId.toString()\n\t\t};\n\t\tconsole.log(d)\n\t\tio.to(token).emit('add-menu-res', d)\n\t});\n\n\tsocket.on('disconnect', () => {\n    io.to(token).emit('chat-message', {\n\t\t  user: {\n\t\t    name: 'Manu',\n\t\t    email: 'manuthecoder@protonmail.com',\n\t\t    image: 'https://replit.com/cdn-cgi/image/width=1920,quality=80/https://storage.googleapis.com/replit/images/1615307601188_444d33267b0ab288b076f21da2abafc2.jpeg'\n\t\t  },\n\t\t  event: '6227ea2c7aabff48117758b7',\n\t\t  msg: 'Manu has left the event',\n\t\t  short: true\n\t\t})\n  });\n});\n\napp.use(async (req, res, next) => {\n\tif(req.path.startsWith('/events/')) {\n\t\tres.render(\"event-page\", {\n\t    event: await eventInfo(req.path.replace(\"/events/\", \"\"), req),\n\t    layout: false,\n\t  });\n\t}\n\tnext();\n})\n\napp.get([\"/\", \"/pages/event-website\"], async (req: any, res: any) => {\n  res.render((req.path == \"/pages/event-website\" ? \"pages/event-website\":\"index\"), {\n    event: await eventInfo(token, req),\n    layout: false\n  });\n});\n\napp.get(\"/pages/overview\", async (req: any, res: any) => {\n  res.render(\"pages/overview\", {\n    event: await eventInfo(token, req),\n    layout: false\n  });\n});\n\napp.get(\"/pages/menu\", async (req: any, res: any) => {\n  res.render(\"pages/menu\", {\n    data: await eventData(token, \"Food\"),\n    layout: false\n  });\n});\n\napp.get(\"/pages/attendees\", async (req: any, res: any) => {\n  res.render(\"pages/attendees\", {\n    data: await eventData(token, \"Attendees\"),\n    layout: false\n  });\n});\n\napp.use(express.static(\"src\"));\n\napp.get(\"/js/app.js\", (req, res) => {\n  res.sendFile(__dirname + \"/src/js/app.js\");\n});\n\napp.get(\"/dist/build.css\", (req, res) => {\n  res.sendFile(\"/home/runner/Events5/dist/output.css\");\n});\n\nconst port = process.env.PORT ?? 443;\nserver.listen(port, () => console.log({\n\tmessage: \"Smartlist collaborate is UP\",\n\tproduct: \"Smartlist Collaborate\",\n\tstatus: \"UP\",\n\ttimestamp: new Date()\n}));"],
  "mappings": "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",
  "names": []
}
